import Head from 'next/head'
import Link from 'next/link'
import { useQuery } from "urql";
import {MEMBER_QUERY} from '../lib/mquery';
import Members from '../components/Members';
import {useState} from 'react'
import { Description } from '../styles/pageDescription';
import { Input } from '../styles/Input';
import { Gallery } from '../styles/Gallery';

export default function Browse() {
  //Fetch products from strapi
  const [results] = useQuery({query: MEMBER_QUERY });
  const {data, fetching, error} = results;
  const [searchTerm, setSearchTerm] = useState('');
  
  // check for incoming data
if(fetching) return <p>Loading...</p>
if(error) return <p>Oh no...</p>
const members = data.members.data;
console.log(members)
  return (
    <div>
      <Head>
        <title>Capstone StorX</title>
        <meta name="description" content="Generated by create next app" />
        <link rel="icon" href="/favicon.ico" />
      </Head>

      <main>
        <Description>
            <h1>Talent Showcase</h1>
            <h5>Understand who are behind these outstanding projects</h5>
            <Input>
              <input className="center-block" type="text" placeholder="Search for Students..." onChange={(event)=>{setSearchTerm(event.target.value);}}/>
            </Input>
        </Description>
        <Gallery>
          {/* search function */}
          {members.filter((member)=> {
            if(searchTerm == ""){
              return member
            } else if (member.attributes.description.toLowerCase().includes(searchTerm.toLowerCase())){
              return member
            } else if (member.attributes.name.toLowerCase().includes(searchTerm.toLowerCase())){
              return member
            }
          }).map((member) => (
            <Members key={member.attributes.slug} member = {member}/>
          ))}
        </Gallery>
      </main>

      <footer>
      </footer>
    </div>

    
  )
}
